modules:
module Test {
    struct T{value: u64}

    initial_value(): u64 {
        return 42;
    }

    public new(): V#Self.T {
        let initial_value: u64;
        initial_value = Self.initial_value();
        return T{value: move(initial_value)};
    }

    public get_value(this: &V#Self.T): u64 {
        let x: &u64;
        x = &copy(this).value;
        release(move(this));
        return *move(x);
    }

    public set_value(this: &mut V#Self.T, new_value: u64) {
        Self.internal_set_value(move(this), move(new_value));
        return;
    }

    internal_set_value(this: &mut V#Self.T, new_value: u64) {
        let x: &mut u64;
        x = &mut copy(this).value;
        *move(x) = move(new_value);
        release(move(this));
        return;
    }
}

script:
import Transaction.Test;

main() {
    let obj: V#Test.T;
    let ref: &V#Test.T;

    obj = Test.new();
    ref = &obj;
    Test.internal_set_value(move(ref), 1);
    return;
}

// check: VerificationError
// check: CallTypeMismatchError(7)

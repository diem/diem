<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `hkdf` mod in crate `libra_crypto`."><meta name="keywords" content="rust, rustlang, rust-lang, hkdf"><title>libra_crypto::hkdf - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css"><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../libra_crypto/index.html'><div class='logo-container'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Module hkdf</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></div><p class='location'><a href='../index.html'>libra_crypto</a></p><script>window.sidebarCurrent = {name: 'hkdf', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/libra_crypto/hkdf.rs.html#4-196' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../index.html'>libra_crypto</a>::<wbr><a class="mod" href=''>hkdf</a></span></h1><div class='docblock'><p>An implementation of HKDF, the HMAC-based Extract-and-Expand Key Derivation Function for the
Libra project based on <a href="https://tools.ietf.org/html/rfc5869">RFC 5869</a>.</p>
<p>The key derivation function (KDF) is intended to support a wide range of applications and
requirements, and is conservative in its use of cryptographic hash functions. In particular,
this implementation is compatible with hash functions that output 256 bits or more, such as
SHA256, SHA3-256 and SHA512.</p>
<p>HKDF follows the &quot;extract-then-expand&quot; paradigm, where the KDF logically consists of two
modules: the first stage takes the input keying material (the seed) and &quot;extracts&quot; from it a
fixed-length pseudorandom key, and then the second stage &quot;expands&quot; this key into several
additional pseudorandom keys (the output of the KDF). For convenience, a function that runs both
steps in a single call is provided. Note that along with an initial high-entropy seed, a user
can optionally provide salt and app-info byte-arrays for extra security guarantees and domain
separation.</p>
<h1 id="applications" class="section-header"><a href="#applications">Applications</a></h1>
<p>HKDF is intended for use in a wide variety of KDF applications (see <a href="https://en.wikipedia.org/wiki/Key_derivation_function">Key derivation function</a>), including:
a) derivation of keys from an origin high-entropy master seed. This is the recommended approach
for generating keys in Libra, especially when a True Random Generator is not available.
b) derivation of session keys from a shared Diffie-Hellman value in a key-agreement protocol.
c) combining entropy from multiple sources of randomness, such as entropy collected
from system events, user's keystrokes, /dev/urandom etc. The combined seed can then be used to
generate cryptographic keys for account, network and transaction signing keys among the others.
d) hierarchical private key derivation, similarly to Bitcoin's BIP32 protocol for easier key
management.
e) hybrid key generation that combines a master seed with a PRNG output for extra security
guarantees against a master seed leak or low PRNG entropy.</p>
<h1 id="recommendations" class="section-header"><a href="#recommendations">Recommendations</a></h1>
<p><strong>Salt</strong>
HKDF can operate with and without random 'salt'. The use of salt adds to the strength of HKDF,
ensuring independence between different uses of the hash function, supporting
&quot;source-independent&quot; extraction, and strengthening the HKDF use. The salt value should be a
random string of the same length as the hash output. A shorter or less random salt value can
still make a contribution to the security of the output key material. Salt values should be
independent of the input keying material. In particular, an application needs to make sure that
salt values are not chosen or manipulated by an attacker.</p>
<p><em>Application info</em>
Key expansion accepts an optional 'info' value to which the application assigns some meaning.
Its objective is to bind the derived key material to application- and context-specific
information.  For example, 'info' may contain a protocol number, algorithm identifier,
child key number (similarly to <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP32</a>), etc. The only technical requirement for 'info' is that
it be independent of the seed.</p>
<p><strong>Which function to use: extract, expand or both?</strong>
Unless absolutely sure of what they are doing, applications should use both steps — if only for
the sake of compatibility with the general case.</p>
<h1 id="example" class="section-header"><a href="#example">Example</a></h1>
<p>Run HKDF extract-then-expand so as to return 64 bytes, using 'salt', 'seed' and 'info' as
inputs.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">libra_crypto</span>::<span class="ident">hkdf</span>::<span class="ident">Hkdf</span>;
<span class="kw">use</span> <span class="ident">sha2</span>::<span class="ident">Sha256</span>;

<span class="comment">// some bytes required for this example.</span>
<span class="kw">let</span> <span class="ident">raw_bytes</span> <span class="op">=</span> [<span class="number">2u8</span>; <span class="number">10</span>];
<span class="comment">// define salt</span>
<span class="kw">let</span> <span class="ident">salt</span> <span class="op">=</span> <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">raw_bytes</span>[<span class="number">0</span>..<span class="number">4</span>]);
<span class="comment">// define seed - in production this is recommended to be a 32 bytes or longer random seed.</span>
<span class="kw">let</span> <span class="ident">seed</span> <span class="op">=</span> [<span class="number">3u8</span>; <span class="number">32</span>];
<span class="comment">// define application info</span>
<span class="kw">let</span> <span class="ident">info</span> <span class="op">=</span> <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">raw_bytes</span>[<span class="number">4</span>..<span class="number">10</span>]);

<span class="comment">// HKDF extract-then-expand 64-bytes output</span>
<span class="kw">let</span> <span class="ident">derived_bytes</span> <span class="op">=</span> <span class="ident">Hkdf</span>::<span class="op">&lt;</span><span class="ident">Sha256</span><span class="op">&gt;</span>::<span class="ident">extract_then_expand</span>(<span class="ident">salt</span>, <span class="kw-2">&amp;</span><span class="ident">seed</span>, <span class="ident">info</span>, <span class="number">64</span>);
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">derived_bytes</span>.<span class="ident">unwrap</span>().<span class="ident">len</span>(), <span class="number">64</span>)</pre></div>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.Hkdf.html" title='libra_crypto::hkdf::Hkdf struct'>Hkdf</a></td><td class='docblock-short'><p>Structure representing the HKDF, capable of HKDF-Extract and HKDF-Expand operations, as defined
in RFC 5869.</p>
</td></tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table><tr class='module-item'><td><a class="enum" href="enum.HkdfError.html" title='libra_crypto::hkdf::HkdfError enum'>HkdfError</a></td><td class='docblock-short'><p>An error type for HKDF key derivation issues.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "libra_crypto";</script><script src="../../aliases.js"></script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>